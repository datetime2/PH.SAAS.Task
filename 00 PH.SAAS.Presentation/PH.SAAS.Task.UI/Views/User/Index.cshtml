<div class="topPanel">
    <div class="toolbar">
        <div class="btn-group">
            <a class="btn btn-primary" onclick="$.reload()"><span class="glyphicon glyphicon-refresh"></span></a>
        </div>
        <div class="btn-group">
            <a id="add" class="btn btn-primary dropdown-text" onclick="$.manageIndex.addManage()"><i class="fa fa-plus"></i>新建用户</a>
        </div>
    </div>
    <div class="search">
        <table>
            <tr>
                <td>
                    <div class="input-group">
                        <input id="txt_keyword" type="text" class="form-control" placeholder="账户/真实姓名" style="width: 200px;">
                        <span class="input-group-btn">
                            <button id="btn_search" type="button" class="btn  btn-primary"><i class="fa fa-search"></i></button>
                        </span>
                    </div>
                </td>
            </tr>
        </table>
    </div>
</div>
<div class="gridPanel">
    <table id="grid"></table>
    <div id="gridPager"></div>
</div>
@section scripts{
    <script src="~/Content/css/plugins/jqgrid/jqgrid.min.js"></script>
    <script src="~/Content/js/plugins/jqgrid/grid.locale-cn.js"></script>
    <script src="~/Content/js/framework-ui.js"></script>
    <script src="~/Content/js/plugins/dialog/dialog.js"></script>

    <script>
        $(function () {
            $.manageIndex.initGrid();
        });
        (function ($) {
            $.manageIndex = {
                initGrid: function () {
                    $("#grid").dataGrid({
                        url: "/User/List",
                        height: $(window).height() - 128,
                        colModel: [
                            { label: '主键', name: 'userId', align: 'center' },
                            { label: '账户', name: 'userName',  align: 'center' },
                            { label: '真实姓名', name: 'realName',  align: 'center' },
                            {
                                label: '创建时间',
                                name: 'createTime',
                                align: 'center',
                                formatter: function (cellvalue, options, rowObject) {
                                    if (cellvalue != '')
                                        return $.FormatDateBoxFull(cellvalue);
                                    else
                                        return cellvalue;
                                }
                            },
                            {
                                label: '修改时间',
                                name: 'lastUpdTime',
                                align: 'center',
                                formatter: function (cellvalue, options, rowObject) {
                                    if (cellvalue != '')
                                        return $.FormatDateBoxFull(cellvalue);
                                    else
                                        return cellvalue;
                                }
                            },
                            {
                                label: "允许登录",
                                name: "isEnabled",
                                align: "center",
                                formatter: function (cellvalue, options, rowObject) {
                                    if (cellvalue == 0)
                                        return '<span class=\"label label-success\">正常</span>';
                                    else
                                        return '<span class=\"label label-default\">禁用</span>';
                                }
                            },
                            { label: '备注', name: 'remark', align: 'left' }
                        ],
                        pager: "#gridPager",
                        sortname: 'UserId',
                        viewrecords: true
                    });
                    $("#btn_search").click(function () {
                        $("#grid").jqGrid('setGridParam', {
                            postData: { keyword: $("#txt_keyword").val() }
                        }).trigger('reloadGrid');
                    });
                },
                addManage: function () {
                    $.modalOpen({
                        id: "Form",
                        title: "新增用户",
                        url: "/User/Form",
                        width: "500px",
                        height: "400px",
                        callBack: function (iframeId) {
                            top.frames[iframeId].$.manageForm.submitForm();
                        }
                    });
                },
                editManage: function () {
                    var keyValue = $("#grid").jqGridRowValue().Id;
                    if (!keyValue) {
                        $.UnChecked();
                        return;
                    }
                    $.modalOpen({
                        id: "Form",
                        title: "修改用户",
                        url: "/User/Form?keyValue=" + keyValue,
                        width: "500px",
                        height: "400px",
                        callBack: function (iframeId) {
                            top.frames[iframeId].$.manageForm.submitForm();
                        }
                    });
                },
                removeManage: function () {
                    if (!$("#grid").jqGridRowValue().Id) {
                        $.UnChecked();
                        return;
                    }
                    $.deleteForm({
                        url: "/User/Delete",
                        param: { keyValue: $("#grid").jqGridRowValue().Id },
                        success: function () {
                            $.currentWindow().$("#grid").trigger("reloadGrid");
                        }
                    });
                }
            };
        })(jQuery);
    </script>
}
@section styles{
    <link href="~/Content/css/plugins/jqgrid/jqgrid.css" rel="stylesheet" />
    <link href="~/Content/css/framework-ui.css" rel="stylesheet" />
}

